{% extends "layout/default.html" %}
{% block content %}
<section class="section" id="mealplan">
    <div>
        <button class="button no-print edit-control" v-on:click="regenMealPlan">Regen all</button>
        <button class="button no-print edit-control" v-on:click="exportMealplan">Export</button>
    </div>
    <div>
        <button class="button no-print" v-on:click="changeWeek(-1)">&lt;</button>
        {{start_date.format('YYYY-MM-DD') }}
        <button class="button no-print" v-on:click="changeWeek('today')">today</button>
        <button class="button no-print" v-on:click="changeWeek(1)">&gt;</button>
    </div>
    <table class="table is-striped is-fullwidth" id="mealplan-table">
        <thead>
            <tr>
                <th>Weekday</th>
                <th>Date</th>
                <th>Recipe</th>
                <th>Constraint</th>
                <th>Tags</th>
                <th class="no-print">Actions</th>
            </tr>
        </thead>
        <tbody>
            <template v-for="(meal, index) in mealplan">
                <tr v-bind:class="{'is-today': meal.date.isSame(new Date(), 'day'), 'placeholder': meal.placeholder}">
                    <td class="no-wrap">{{ meal.date.format('dddd') }}</td>
                    <td class="no-wrap">{{ meal.date.format('YYYY-MM-DD') }}</td>
                    <template v-if="meal.placeholder == true">
                        <td>No meal planned</td>
                        <td></td>
                        <td></td>
                    </template>
                    <template v-else>
                        <td>
                            <a v-if="meal.recipe.url" :href="meal.recipe.url" target="_blank">
                                {{ meal.recipe.name }}
                            </a>
                            <template v-else>{{ meal.recipe.name }}</template>
                        </td>
                        <td class="no-wrap">{{ meal.constraint == null ? "NA" : meal.constraint.title }}</td>
                        <td class="no-wrap">
                            <span class="tag" :data-value="tag.name" v-for="tag in meal.recipe.tags">
                                {{tag.display_name}}
                            </span>
                        </td>
                    </template>

                    <td class="no-print"><button class="button edit-control" v-on:click="regenMeal(index)">Regen</button></td>
                </tr>
                <!-- <tr class="edit-control">
                    <td>edit</td>
                </tr> -->
            </template>
        </tbody>
    </table>
</section>
{% endblock %}